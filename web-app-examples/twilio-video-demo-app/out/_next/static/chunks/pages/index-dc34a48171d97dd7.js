(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{48312:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return t(51139)}])},51139:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return Cn}});var i=t(85893),r=t(9008),o=t.n(r),a=t(67063),c=t(67294),s=t(98445),l=t.n(s),u=t(36562),d=t(7297),h=t(50686);function p(){var e=(0,d.Z)(["\n    display: block;\n    @media only screen and (max-width: 768px) {\n      display: none;\n    }\n  "]);return p=function(){return e},e}var f=h.iK.video((0,h.iv)({width:"100%",height:"100%"})),v=h.iK.div((0,h.iv)({display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#000000",position:"absolute",top:0,right:0,bottom:0,left:0,zIndex:1})),m=h.iK.div((0,h.iv)({position:"relative",height:0,overflow:"hidden",paddingTop:"".concat(56.25,"%"),width:"100%",borderRadius:"6px"})),x=h.iK.div((0,h.iv)({position:"absolute",top:0,left:0,width:"100%",height:"100%"})),g=h.iK.div((0,h.iv)({paddingX:"space40",paddingTop:"space160",paddingBottom:"space60",width:"100%",minHeight:"100vh",justifyContent:"center",flexDirection:"column",backgroundColor:"rgb(45, 46, 45)",alignItems:"center",alignContent:"center",horizontalAlign:"center"})),j=h.iK.div((0,h.iv)({position:"absolute",top:20,left:5,padding:"space20",zIndex:60,fontSize:"3rem"})),k=h.iK.div((0,h.iv)({position:"absolute",bottom:0,opacity:.8,padding:"space20",backgroundColor:"#FFFFFF",zIndex:60,borderRadius:"0px 6px 0px 0px"})),b="30px",S=h.iK.div((0,h.iv)({height:"calc(100vh - 160px)",position:"absolute",display:"flex",top:b,right:b,bottom:b,left:b,margin:"0 auto",alignContent:"center",flexWrap:"wrap",justifyContent:"center"})),y="15px",w=h.iK.div((0,h.iv)({height:"calc(100vh - 160px)",position:"absolute",display:"flex",top:y,right:y,bottom:y,left:y,margin:"0 auto",alignContent:"center",flexWrap:"wrap",justifyContent:"center"})),T=h.iK.div((0,h.iv)({height:"100%",display:"flex",margin:"0 auto",alignContent:"center",flexWrap:"wrap",justifyContent:"center"})),C=h.iK.div((0,h.iv)({width:"100%",height:"100vh",position:"relative",backgroundColor:"rgb(45, 46, 45)"})),E=h.iK.div((0,h.iv)({display:"flex",height:"100%",width:"100%",alignItems:"center",justifyContent:"center",position:"absolute",backgroundColor:"rgba(45, 46, 45, 0.5)",backdropFilter:"blur(5px)",zIndex:70})),I=h.iK.div((0,h.iv)({width:"100%",height:"70px",backgroundColor:"rgb(246, 246, 246)",paddingRight:"14px",paddingLeft:"14px",position:"absolute",bottom:0,zIndex:80})),P=h.iK.div((0,h.iv)({maxWidth:"500px",marginTop:"space40",minWidth:"350px",justifyContent:"center"})),N=h.iK.div((0,h.iv)(p()));function _(e){var n=e.children,t=(0,c.useState)(!0),r=t[0],o=t[1];return(0,c.useEffect)((function(){l().isSupported||o(!1)}),[]),r?n:(0,i.jsx)(g,{children:(0,i.jsx)(u.Flex,{hAlignContent:"center",vertical:!0,vAlignContent:"center",height:"100%",children:(0,i.jsx)(P,{children:(0,i.jsxs)(u.Card,{children:[(0,i.jsx)(u.Heading,{as:"h4",variant:"heading40",children:"Browser or context not supported"}),(0,i.jsxs)(u.Text,{as:"p",fontSize:"fontSize20",fontWeight:"fontWeightMedium",color:"colorText",children:["Please open this application in one of the"," ",(0,i.jsx)("a",{href:"https://www.twilio.com/docs/video/javascript#supported-browsers",target:"_blank",rel:"noopener",children:"supported browsers"}),".",(0,i.jsx)("br",{}),(0,i.jsx)("br",{}),"If you are using a supported browser, please ensure that this app is served over a"," ",(0,i.jsx)("a",{href:"https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts",target:"_blank",rel:"noopener",children:"secure context"})," ","(e.g. https or localhost)."]})]})})})})}var D,F,O=t(41799),A=t(69396),Z=t(51351),R=t(11163),z=t(87536),M=t(47533),L=t(74231),B=t(64529);!function(e){e.NOT_CONNECTED="NOT_CONNECTED",e.CONNECTED="CONNECTED"}(D||(D={})),function(e){e.LANDING_SCREEN="LANDING_SCREEN",e.PRE_JOIN_SCREEN="PRE_JOIN_SCREEN",e.VIDEO_ROOM="VIDEO_ROOM",e.VIDEO_ROOM_DISCONNECT="VIDEO_ROOM_DISCONNECT"}(F||(F={}));var V=(0,B.ZP)()((function(e,n){return{room:null,disconnectError:null,status:D.NOT_CONNECTED,uiStep:F.LANDING_SCREEN,formData:{identity:void 0,roomName:void 0},devicePermissions:{camera:!1,microphone:!1},hasSkippedPermissionCheck:!1,localEmoji:void 0,localTracks:{audio:void 0,video:void 0,screen:void 0,data:void 0},activeSinkId:void 0,setActiveSinkId:function(n){return e({activeSinkId:n})},setHasSkippedPermissionCheck:function(n){return e({hasSkippedPermissionCheck:n})},setDevicePermissions:function(t,i){var r=n().devicePermissions;"camera"===t&&e({devicePermissions:(0,A.Z)((0,O.Z)({},r),{camera:i})}),"microphone"===t&&e({devicePermissions:(0,A.Z)((0,O.Z)({},r),{microphone:i})})},setLocalEmoji:function(n){return e({localEmoji:null!==n&&void 0!==n?n:void 0})},setLocalTracks:function(t,i){var r=n().localTracks;"audio"===t&&e({localTracks:(0,A.Z)((0,O.Z)({},r),{audio:i})}),"video"===t&&e({localTracks:(0,A.Z)((0,O.Z)({},r),{video:i})}),"screen"===t&&e({localTracks:(0,A.Z)((0,O.Z)({},r),{screen:i})}),"data"===t&&e({localTracks:(0,A.Z)((0,O.Z)({},r),{data:i})})},clearTrack:function(t){var i=n().localTracks;"video"===t&&e({localTracks:(0,A.Z)((0,O.Z)({},i),{video:void 0})}),"audio"===t&&e({localTracks:(0,A.Z)((0,O.Z)({},i),{audio:void 0})}),"screen"===t&&e({localTracks:(0,A.Z)((0,O.Z)({},i),{screen:void 0})})},setFormData:function(n){return e({formData:n})},setUIStep:function(n){return e({uiStep:n})},setActiveRoom:function(n){return e({room:n})},setDisconnectError:function(n,t){return e({disconnectError:{code:n,message:t}})},clearActiveRoom:function(){return e({room:null,disconnectError:null,hasSkippedPermissionCheck:!1,localEmoji:void 0,devicePermissions:{camera:!1,microphone:!1},localTracks:{audio:void 0,video:void 0,screen:void 0,data:void 0}})},resetState:function(){e({room:null,disconnectError:null,status:D.NOT_CONNECTED,uiStep:F.LANDING_SCREEN,hasSkippedPermissionCheck:!1,devicePermissions:{camera:!1,microphone:!1},localEmoji:void 0,localTracks:{audio:void 0,video:void 0,screen:void 0,data:void 0},formData:{identity:void 0,roomName:void 0}})}}})),W="TwilioVideoApp-selectedAudioInput",U="TwilioVideoApp-selectedAudioOutput",H="TwilioVideoApp-selectedVideoInput",K=9/16,G=["Couldn't hear","Others couldn't hear","Video was low quality","Video froze or was choppy","Couldn't see participants","Sound didn't match video","Participants couldn't see me","Other issue"],q="Room name was auto-populated by invite URL",X="To join a video room manually, please enter the room name.",Q="To actively participate in the video call, this application will need permission to access your camera and microphone. After acknowledgement, the browser will request permission.",Y="Click to join the video room!",J="Please wait while we check your connection...",$="Failed connectivity checks to Twilio Cloud - please check your network connection.",ee="Audio & Video Settings",ne="Configure your audio and video settings",te="Waiting for other participants to join...",ie="Leave Room?",re="Are you sure you want to leave the video room?",oe="You have disconnected from the room.",ae="You were disconnected from the room due to an error:",ce="Survey / Experience Collection",se="Use this state of the application to gather post video room surveys (gauge the overall experience, issues faced, etc.)",le=t(47568),ue=t(97582);function de(e){return he.apply(this,arguments)}function he(){return(he=(0,le.Z)((function(e){var n;return(0,ue.__generator)(this,(function(t){switch(t.label){case 0:if(n=e,!navigator.permissions)return[3,5];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,navigator.permissions.query({name:n})];case 2:return[2,t.sent()];case 3:return t.sent(),[2,null];case 4:return[3,6];case 5:return[2,null];case 6:return[2]}}))}))).apply(this,arguments)}function pe(){return(pe=(0,le.Z)((function(){var e;return(0,ue.__generator)(this,(function(n){switch(n.label){case 0:return[4,navigator.mediaDevices.enumerateDevices()];case 1:return[2,{audioInputDevices:(e=n.sent()).filter((function(e){return"audioinput"===e.kind})),videoInputDevices:e.filter((function(e){return"videoinput"===e.kind})),audioOutputDevices:e.filter((function(e){return"audiooutput"===e.kind})),hasAudioInputDevices:e.some((function(e){return"audioinput"===e.kind})),hasVideoInputDevices:e.some((function(e){return"videoinput"===e.kind})),isMicPermissionGranted:e.filter((function(e){return"audioinput"===e.kind})).every((function(e){return e.label})),isCameraPermissionGranted:e.filter((function(e){return"videoinput"===e.kind})).every((function(e){return e.label}))}]}}))}))).apply(this,arguments)}"undefined"!==typeof navigator&&"string"===typeof navigator.userAgent&&/Mobile/.test(navigator.userAgent);var fe=L.Ry({identity:L.Z_().required(),roomName:L.Z_().required()}).required();function ve(e){e=null!==e?e:(0,Z.Z)(new TypeError("Cannot destructure undefined"));var n,t,r,o,a=(0,R.useRouter)(),s=(0,c.useState)(!1),l=s[0],d=s[1],h=(0,c.useState)(!1),p=h[0],f=h[1],v=q,m=X,x=V((function(e){return e})),j=x.setUIStep,k=x.setFormData,b=x.setDevicePermissions,S=(0,c.useRef)(null),y=(0,z.cI)({resolver:(0,M.X)(fe),mode:"onSubmit",defaultValues:{identity:"",roomName:""}}),w=y.register,T=y.handleSubmit,C=y.formState.errors,E=y.setValue;return(0,c.useEffect)((function(){var e=a.query,n=e.identity,t=e.roomName;n&&(E("identity",String(n)),d(!0)),t&&(E("roomName",String(t)),f(!0))}),[a]),(0,c.useEffect)((function(){var e;p&&l&&(null===(e=S.current)||void 0===e||e.click())}),[p,l]),(0,c.useEffect)((function(){de("camera").then((function(e){var n="granted"===(null===e||void 0===e?void 0:e.state);b("camera",n)})),de("microphone").then((function(e){var n="granted"===(null===e||void 0===e?void 0:e.state);b("microphone",n)}))}),[]),(0,i.jsx)(g,{children:(0,i.jsx)(u.Flex,{hAlignContent:"center",vertical:!0,vAlignContent:"center",height:"100%",children:(0,i.jsx)(P,{children:(0,i.jsxs)(u.Stack,{orientation:"vertical",spacing:"space60",children:[(0,i.jsxs)(u.Callout,{variant:"new",children:[(0,i.jsx)(u.CalloutHeading,{as:"h3",children:"Ahoy!"}),(0,i.jsxs)(u.CalloutText,{children:["This quickstart application aims at getting you stood up rapidly with a React web application, powered by"," ",(0,i.jsx)("a",{href:"https://www.twilio.com/docs/video/javascript",target:"_blank",rel:"noopener",children:"Twilio Video JS"}),"."]})]}),(0,i.jsx)(u.Card,{children:(0,i.jsx)("form",{onSubmit:T((function(e){k(e),j(F.PRE_JOIN_SCREEN)})),children:(0,i.jsxs)(u.Flex,{vertical:!0,children:[(0,i.jsxs)(u.Flex,{marginTop:"space20",vertical:!0,width:"100%",children:[(0,i.jsx)(u.Label,{htmlFor:"identity",required:!0,children:"Participant Name"}),(0,i.jsx)(u.Input,(0,A.Z)((0,O.Z)({},w("identity")),{type:"text",disabled:l})),C.identity&&(0,i.jsx)(u.Flex,{marginTop:"space40",marginBottom:"space40",children:(0,i.jsx)(u.Alert,{variant:"error",children:null!==(r=null===C||void 0===C||null===(n=C.identity)||void 0===n?void 0:n.message)&&void 0!==r?r:""})})]}),(0,i.jsxs)(u.Flex,{marginTop:"space40",vertical:!0,width:"100%",children:[(0,i.jsx)(u.Label,{htmlFor:"roomName",required:!0,children:"Room Name"}),(0,i.jsx)(u.Input,(0,A.Z)((0,O.Z)({},w("roomName")),{type:"text",placeholder:"ex. 123456",disabled:p})),(0,i.jsx)(u.HelpText,{id:"email_help_text",children:p?v:m}),C.roomName&&(0,i.jsx)(u.Flex,{marginTop:"space40",marginBottom:"space40",children:(0,i.jsx)(u.Alert,{variant:"error",children:null!==(o=null===C||void 0===C||null===(t=C.roomName)||void 0===t?void 0:t.message)&&void 0!==o?o:""})})]}),(0,i.jsx)(u.Flex,{marginTop:"space40",children:(0,i.jsx)(u.Button,{ref:S,type:"submit",variant:"destructive",style:{background:"#F22F46"},children:"Next"})})]})})})]})})})})}function me(e){e=null!==e?e:(0,Z.Z)(new TypeError("Cannot destructure undefined"));var n=(0,u.useToaster)(),t=V((function(e){return e})),r=t.setHasSkippedPermissionCheck,o=t.setDevicePermissions,a=(0,c.useState)(!1),s=a[0],l=a[1],d=Q;(0,c.useEffect)((function(){h()}),[]);function h(){return p.apply(this,arguments)}function p(){return p=(0,le.Z)((function(){var e;return(0,ue.__generator)(this,(function(t){switch(t.label){case 0:l(!0),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then(function(){var e=(0,le.Z)((function(e){return(0,ue.__generator)(this,(function(n){return e.getTracks().forEach((function(e){e.stop()})),[2]}))}));return function(n){return e.apply(this,arguments)}}())];case 2:return t.sent(),setTimeout((function(){return navigator.mediaDevices.dispatchEvent(new Event("devicechange"))}),500),o("camera",!0),o("microphone",!0),r(!0),l(!1),[3,4];case 3:return e=t.sent(),n.push({message:"Error requesting permission to camera and mic: ".concat(e.message),variant:"error"}),r(!0),l(!1),[3,4];case 4:return[2]}}))})),p.apply(this,arguments)}return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(P,{children:(0,i.jsxs)(u.Card,{children:[(0,i.jsx)(u.Heading,{as:"h4",variant:"heading40",children:"Browser Permissions Needed"}),(0,i.jsx)(u.Text,{as:"p",fontSize:"fontSize20",fontWeight:"fontWeightMedium",color:"colorText",children:d}),(0,i.jsx)(u.Flex,{marginTop:"space60",grow:!0,hAlignContent:"center",children:(0,i.jsxs)(u.Stack,{orientation:"horizontal",spacing:"space30",children:[(0,i.jsx)(u.Button,{variant:"primary",onClick:h,loading:s,children:"Understood"}),(0,i.jsx)(u.Button,{variant:"secondary",onClick:function(){r(!0)},children:"Skip"})]})})]})}),(0,i.jsx)(u.Toaster,(0,O.Z)({},n))]})}var xe=t(63750),ge=t(5434);function je(e){var n=e.track,t=e.priority,r=(0,c.useRef)(null);(0,c.useEffect)((function(){var e=r.current;return e.muted=!0,n.attach(e),function(){null===n||void 0===n||n.detach(e),e.srcObject=null}}),[n,t]);return(0,i.jsx)(f,{ref:r,style:{objectFit:"cover",transform:"scaleX(-1)"}})}function ke(e){var n=e.identity,t=e.localVideo;return(0,i.jsxs)(m,{children:[(0,i.jsx)(x,{children:t&&!t.isStopped?(0,i.jsx)(je,{track:t}):(0,i.jsx)(v,{children:(0,i.jsx)(u.Avatar,{size:["sizeIcon70","sizeIcon110"],name:n})})}),(0,i.jsx)(k,{children:(0,i.jsxs)(u.Text,{as:"p",color:"colorText",fontSize:["fontSize10","fontSize20","fontSize30"],children:[n," (You)"]})})]})}var be=t(828),Se=t(10039),ye=t(86893);function we(e){var n=e.camera,t=e.microphone,i=(0,c.useState)({audioInputDevices:[],videoInputDevices:[],audioOutputDevices:[],hasAudioInputDevices:!1,hasVideoInputDevices:!1,isMicPermissionGranted:!1,isCameraPermissionGranted:!1}),r=i[0],o=i[1];return(0,c.useEffect)((function(){var e=function(){return function(){return pe.apply(this,arguments)}().then((function(e){return o(e)}))};return navigator.mediaDevices.addEventListener("devicechange",e),e(),function(){navigator.mediaDevices.removeEventListener("devicechange",e)}}),[n,t]),r}function Te(e){e=null!==e?e:(0,Z.Z)(new TypeError("Cannot destructure undefined"));var n,t,r,o=function(e,n){var t=function(e,n){var t=n.find((function(n){return n.deviceId===e}));return void 0!==t?t:null}(e,"video"===n?F:"audioInput"===n?A:R);console.log("changed ".concat(n," to "),null===t||void 0===t?void 0:t.label),"video"===n&&(null===M||void 0===M?void 0:M.mediaStreamTrack.id)!==e&&(T(e),localStorage.setItem(H,e),a(e)),"audioInput"===n&&(I(e),localStorage.setItem(W,e),l(e)),"audioOutput"===n&&(_(e),localStorage.setItem(U,e),j(e))},a=function(e){M?M.restart({deviceId:{exact:e}}):s.createLocalVideoTrack({deviceId:{exact:e}}).then((function(e){L(e)})).catch((function(e){d.push({message:"Error creating local track - ".concat(e.message),variant:"error"})}))},l=function(e){K?K.restart({deviceId:{exact:e}}):s.createLocalAudioTrack({deviceId:{exact:e}}).then((function(e){G(e)})).catch((function(e){d.push({message:"Error creating local track - ".concat(e.message),variant:"error"})}))},d=(0,u.useToaster)(),h=ee,p=ne,f=V((function(e){return e})),v=f.localTracks,m=f.formData,x=f.devicePermissions,g=f.activeSinkId,j=f.setActiveSinkId,k=f.room,b=v.video,S=v.audio,y=(0,c.useState)(localStorage.getItem(H)),w=y[0],T=y[1],C=(0,c.useState)(localStorage.getItem(W)),E=C[0],I=C[1],P=(0,c.useState)(localStorage.getItem(U)),N=P[0],_=P[1],D=we(x),F=D.videoInputDevices,A=D.audioInputDevices,R=D.audioOutputDevices,z=(0,c.useState)(b),M=z[0],L=z[1],B=(0,c.useState)(S),K=B[0],G=B[1],q=function(e){var n=(0,c.useState)(null===e||void 0===e?void 0:e.mediaStreamTrack),t=n[0],i=n[1];return(0,c.useEffect)((function(){if(i(null===e||void 0===e?void 0:e.mediaStreamTrack),e){var n=function(){return i(e.mediaStreamTrack)};return e.on("started",n),function(){e.off("started",n)}}}),[e]),t}(M),X=(null===q||void 0===q?void 0:q.getSettings().deviceId)||w||(null===(n=null===F||void 0===F?void 0:F.find((function(e){return"videoinput"===e.kind})))||void 0===n?void 0:n.deviceId),Q=E||(null===(t=null===A||void 0===A?void 0:A.find((function(e){return"audioinput"===e.kind})))||void 0===t?void 0:t.deviceId),Y=N||g||(null===(r=null===R||void 0===R?void 0:R.find((function(e){return"audioinput"===e.kind})))||void 0===r?void 0:r.deviceId),J=m.identity,$=(0,Se.useUID)(),te=(0,be.Z)(c.useState(!1),2),ie=te[0],re=te[1],oe=function(){b||null===M||void 0===M||M.stop(),re(!1)};return(0,c.useEffect)((function(){console.log("useEffect > ConfigureSettings"),console.log("devicePermissions",x)}),[x]),(0,i.jsxs)(u.Flex,{hAlignContent:"center",width:"100%",children:[(0,i.jsx)(u.Tooltip,{text:"Configure settings",placement:"top",children:(0,i.jsxs)(u.Button,{variant:k?"reset":"secondary",onClick:function(){x.camera&&X&&(b?L(b):a(X)),re(!0)},children:[(0,i.jsx)(ye.nbt,{style:{width:"25px",height:"25px",marginRight:k?"0px":"6px"}}),k?null:"Settings"]})}),(0,i.jsxs)(u.Modal,{ariaLabelledby:$,isOpen:ie,onDismiss:oe,size:"default",children:[(0,i.jsx)(u.ModalHeader,{children:(0,i.jsx)(u.ModalHeading,{as:"h3",id:$,children:h})}),(0,i.jsxs)(u.ModalBody,{children:[(0,i.jsx)(u.Paragraph,{children:p}),(0,i.jsxs)(u.Stack,{orientation:"vertical",spacing:"space60",children:[x.camera&&(0,i.jsx)(ke,{identity:null!==J&&void 0!==J?J:"Guest",localVideo:M}),(0,i.jsxs)(u.Stack,{orientation:"vertical",spacing:"space30",children:[(0,i.jsxs)(u.Label,{htmlFor:"author",children:["Video"," ",x.camera&&void 0===b?"(disabled)":(null===b||void 0===b?void 0:b.isStopped)?"(stopped)":""]}),(0,i.jsx)(u.Select,{id:"author",onChange:function(e){return o(e.target.value,"video")},defaultValue:x.camera?null!==X&&void 0!==X?X:"":"no-cam-permission",disabled:F.length<2||!x.camera,children:x.camera?F.map((function(e){return(0,i.jsx)(u.Option,{value:e.deviceId,children:e.label},e.deviceId)})):(0,i.jsx)(u.Option,{value:"no-cam-permission",children:"Camera permissions have not been granted in the browser"},"no-cam-permission")})]}),(0,i.jsxs)(u.Stack,{orientation:"vertical",spacing:"space30",children:[(0,i.jsx)(u.Label,{htmlFor:"author",children:"Audio Input"}),(0,i.jsx)(u.Select,{id:"author",onChange:function(e){return o(e.target.value,"audioInput")},defaultValue:x.microphone?Q:"no-mic-permission",disabled:A.length<2||!x.microphone,children:x.microphone?A.map((function(e){return(0,i.jsx)(u.Option,{value:e.deviceId,children:e.label},e.deviceId)})):(0,i.jsx)(u.Option,{value:"no-mic-permission",children:"Microphone permissions have not been granted in the browser"},"no-mic-permission")})]}),(0,i.jsxs)(u.Stack,{orientation:"vertical",spacing:"space30",children:[(0,i.jsx)(u.Label,{htmlFor:"author",children:"Audio Output"}),(0,i.jsx)(u.Select,{id:"author",onChange:function(e){return o(e.target.value,"audioOutput")},defaultValue:x.microphone?Y:"no-mic-permission",children:x.microphone?R.map((function(e){return(0,i.jsx)(u.Option,{value:e.deviceId,children:e.label},e.deviceId)})):(0,i.jsx)(u.Option,{value:"no-mic-permission",children:"Microphone permissions have not been granted in the browser"},"no-mic-permission")})]})]})]}),(0,i.jsx)(u.ModalFooter,{children:(0,i.jsx)(u.ModalFooterActions,{children:(0,i.jsx)(u.Button,{variant:"destructive",onClick:oe,children:"Back"})})})]}),(0,i.jsx)(u.Toaster,(0,O.Z)({},d))]})}var Ce,Ee=t(88767),Ie=t(6154),Pe=t(83454),Ne="http".concat((null===(Ce="localhost:3001")?void 0:Ce.startsWith("localhost"))?"":"s","://").concat("localhost:3001"),_e=function(){var e=(0,le.Z)((function(e,n){return(0,ue.__generator)(this,(function(t){switch(t.label){case 0:return[4,Ie.Z.get("".concat(Ne,"/features/chat-to-video-escalation/common/client-get-token?roomName=").concat(e,"&identity=").concat(n))];case 1:return[2,t.sent().data]}}))}));return function(n,t){return e.apply(this,arguments)}}(),De=function(){var e=(0,le.Z)((function(e){return(0,ue.__generator)(this,(function(n){switch(n.label){case 0:return Pe.env.NEXT_PUBLIC_LOGGING_ENDPOINT?[4,Ie.Z.post("".concat(Pe.env.NEXT_PUBLIC_LOGGING_ENDPOINT),{data:e}).then((function(e){console.log(e)})).catch((function(e){console.log(e)}))]:[2];case 1:return n.sent(),[2]}}))}));return function(n){return e.apply(this,arguments)}}(),Fe=function(){var e=(0,le.Z)((function(e){return(0,ue.__generator)(this,(function(n){switch(n.label){case 0:return Pe.env.NEXT_PUBLIC_SURVEY_ENDPOINT?[4,Ie.Z.post("".concat(Pe.env.NEXT_PUBLIC_SURVEY_ENDPOINT),e).then((function(e){console.log(e)})).catch((function(e){console.log(e)}))]:[2];case 1:return n.sent(),[2]}}))}));return function(n){return e.apply(this,arguments)}}(),Oe=t(8193),Ae=t(60155);function Ze(e){e=null!==e?e:(0,Z.Z)(new TypeError("Cannot destructure undefined"));var n=V((function(e){return e})).devicePermissions;return(0,i.jsxs)(u.Flex,{hAlignContent:"center",vAlignContent:"center",vertical:!0,children:[(0,i.jsxs)(u.Flex,{hAlignContent:"center",vAlignContent:"center",marginBottom:"space20",children:[(0,i.jsx)(ge.wr$,{style:{width:"20px",height:"20px",color:"rgb(221, 39, 0)",marginRight:"5px"}}),(0,i.jsx)(u.Text,{as:"p",fontSize:"fontSize20",children:"We don't have all permissions needed:"})]}),(0,i.jsxs)(u.Flex,{hAlignContent:"center",vAlignContent:"center",children:[n.microphone?(0,i.jsx)(Ae.Q$f,{style:{width:"20px",height:"20px",color:"rgb(72, 221, 0)",marginRight:"5px"}}):(0,i.jsx)(Oe.cq1,{style:{width:"20px",height:"20px",marginRight:"5px",color:"rgb(221, 39, 0)"}}),(0,i.jsx)(u.Text,{as:"p",fontSize:"fontSize20",children:"Microphone"})]}),(0,i.jsxs)(u.Flex,{hAlignContent:"center",vAlignContent:"center",children:[n.camera?(0,i.jsx)(Ae.Q$f,{style:{width:"20px",height:"20px",color:"rgb(72, 221, 0)",marginRight:"5px"}}):(0,i.jsx)(Oe.cq1,{style:{width:"20px",height:"20px",marginRight:"5px",color:"rgb(221, 39, 0)"}}),(0,i.jsx)(u.Text,{as:"p",fontSize:"fontSize20",children:"Camera"})]})]})}function Re(e){e=null!==e?e:(0,Z.Z)(new TypeError("Cannot destructure undefined"));var n=(0,u.useToaster)(),t=$,r=Y,o=J,a=V((function(e){return e})).formData,l=V((function(e){return e})),d=l.localTracks,h=l.setLocalTracks,p=l.clearTrack,f=l.setActiveRoom,v=l.setUIStep,m=l.devicePermissions,x=l.setDevicePermissions,g=(0,c.useState)(!1),j=g[0],k=g[1],b=(0,c.useState)(!1),S=b[0],y=b[1],w=(0,c.useState)("idle"),T=w[0],C=w[1],E=a.roomName,I=a.identity,N=function(e,n){return(0,Ee.useQuery)(["token",e,n],(0,le.Z)((function(){return(0,ue.__generator)(this,(function(t){switch(t.label){case 0:return[4,_e(e,n)];case 1:return[2,t.sent()]}}))})),{enabled:!(null===e||void 0===e?void 0:e.includes("undefined")),refetchOnWindowFocus:!1,refetchOnReconnect:!1})}(E,I),_=N.data,D=N.isFetching,A=N.status,R=(0,c.useState)(!1),z=R[0],M=R[1],L=d.video,B=d.audio,U=function(){var e=(0,le.Z)((function(){var e,t;return(0,ue.__generator)(this,(function(i){return M(!0),e=new s.LocalDataTrack({name:"emoji"}),h("data",e),t=[e],L&&t.push(L),d.audio&&t.push(d.audio),_.token&&s.connect(_.token,{tracks:t,dominantSpeaker:!0,networkQuality:{local:1,remote:1}}).then((function(e){return f(e)})).then((function(){return v(F.VIDEO_ROOM)})).catch((function(e){n.push({message:"Error joining room - ".concat(e.message),variant:"error"})})),M(!1),[2]}))}));return function(){return e.apply(this,arguments)}}();function K(){return K=(0,le.Z)((function(){var e,t,i;return(0,ue.__generator)(this,(function(r){switch(r.label){case 0:return j?(null===(e=d.audio)||void 0===e||e.stop(),p("audio"),k(!1),[3,5]):[3,1];case 1:return t=localStorage.getItem(W),B?(null===L||void 0===L||L.restart(),k(!0),[3,5]):[3,2];case 2:return t?[3,4]:[4,navigator.mediaDevices.enumerateDevices().then((function(e){var n,t=null===(n=e.find((function(e){return"audioinput"===e.kind})))||void 0===n?void 0:n.deviceId;return null!==t&&void 0!==t?t:null}))];case 3:i=r.sent(),t=i,r.label=4;case 4:t?s.createLocalTracks({audio:{deviceId:t},video:!1}).then((function(e){h("audio",e[0]),k(!0),x("camera",!0)})).catch((function(e){n.push({message:"Error: ".concat(e.message),variant:"error"}),k(!1)})):(n.push({message:"Error: No video device found",variant:"error"}),k(!1)),r.label=5;case 5:return[2]}}))})),K.apply(this,arguments)}function G(){return G=(0,le.Z)((function(){var e,t;return(0,ue.__generator)(this,(function(i){switch(i.label){case 0:return S?(null===L||void 0===L||L.stop(),p("video"),y(!1),[3,5]):[3,1];case 1:return e=localStorage.getItem(H),L?(null===L||void 0===L||L.restart(),y(!0),[3,5]):[3,2];case 2:return e?[3,4]:[4,navigator.mediaDevices.enumerateDevices().then((function(e){var n,t=null===(n=e.find((function(e){return"videoinput"===e.kind})))||void 0===n?void 0:n.deviceId;return null!==t&&void 0!==t?t:null}))];case 3:t=i.sent(),e=t,i.label=4;case 4:e?s.createLocalTracks({video:{deviceId:e},audio:!1}).then((function(e){h("video",e[0]),y(!0),x("camera",!0)})).catch((function(e){n.push({message:"Error: ".concat(e.message),variant:"error"}),y(!1)})):(n.push({message:"Error: No video device found",variant:"error"}),y(!1)),i.label=5;case 5:return[2]}}))})),G.apply(this,arguments)}return(0,c.useEffect)((function(){if("success"===A){C("loading");var e=_.token,t=s.runPreflight(e,{duration:Number("2000")||1e4});t.on("progress",(function(e){console.log("progress ",e)})),t.on("completed",(function(e){console.log("completed",e),C("passed")})),t.on("failed",(function(e){console.log("failed",e),n.push({message:"Preflight test failed \ud83d\ude41",variant:"error"}),C("failed")}))}else"error"===A&&n.push({message:"Unable to join the requested room.",variant:"error"})}),[A]),(0,i.jsxs)(P,{children:[(0,i.jsx)(u.Card,{paddingTop:"space60",children:(0,i.jsxs)(u.Stack,{orientation:"vertical",spacing:"space40",children:[(0,i.jsx)(ke,{identity:null!==I&&void 0!==I?I:"Guest",localVideo:L}),(0,i.jsxs)(u.Flex,{hAlignContent:"center",children:[(0,i.jsx)(u.Switch,{checked:j,onChange:function(){!function(){K.apply(this,arguments)}()},children:j?(0,i.jsx)(xe.OnQ,{style:{width:"20px",height:"20px",marginRight:"20px",color:"rgb(72, 221, 0)"}}):(0,i.jsx)(xe.C4C,{style:{width:"20px",height:"20px",marginRight:"20px",color:"rgb(221, 39, 0)"}})}),(0,i.jsx)(u.Switch,{checked:S,onChange:function(){!function(){G.apply(this,arguments)}()},children:S?(0,i.jsx)(xe.LsT,{style:{width:"20px",height:"20px",color:"rgb(72, 221, 0)"}}):(0,i.jsx)(xe.kwV,{style:{width:"20px",height:"20px",color:"rgb(221, 39, 0)"}})})]}),(!m.camera||!m.microphone)&&(0,i.jsx)(Ze,{}),(0,i.jsx)(Te,{}),(0,i.jsx)(u.Flex,{hAlignContent:"center",width:"100%",children:(0,i.jsxs)(u.Stack,{orientation:"vertical",spacing:"space30",children:[(0,i.jsx)(u.Flex,{hAlignContent:"center",width:"100%",marginTop:"space30",children:(0,i.jsx)(u.Button,{variant:"destructive",onClick:(0,le.Z)((function(){return(0,ue.__generator)(this,(function(e){switch(e.label){case 0:return[4,U()];case 1:return[2,e.sent()]}}))})),loading:z,style:{background:"#F22F46"},disabled:"passed"!==T||"success"!==A||D,children:function(){switch(T){case"idle":return"Join Room";case"loading":return"Loading...";case"passed":return"Join Video Room";case"failed":return"Unable to join"}}()})}),"failed"!==T&&"passed"!==T?(0,i.jsx)("span",{style:{color:"#000000",lineHeight:1,fontSize:"12px",letterSpacing:"wider",marginTop:"15px",textAlign:"center"},children:o}):"failed"!==T?(0,i.jsx)("span",{style:{color:"#000000",lineHeight:1,fontSize:"12px",letterSpacing:"wider",marginTop:"15px",textAlign:"center"},children:r}):(0,i.jsxs)(u.Flex,{marginTop:"space20",children:[(0,i.jsx)(ge.wr$,{style:{width:"20px",height:"20px",color:"rgb(221, 39, 0)",marginRight:"10px"}}),(0,i.jsx)(u.Text,{as:"p",fontSize:"fontSize20",children:t})]})]})})]})}),(0,i.jsx)(u.Toaster,(0,O.Z)({},n))]})}function ze(){var e=V((function(e){return e})),n=e.devicePermissions,t=e.hasSkippedPermissionCheck,r=(0,c.useState)(!0),o=r[0],a=r[1],s=(0,c.useState)(!0),l=s[0],d=s[1];return(0,c.useEffect)((function(){var e=!(!n.camera||!n.microphone);t?(a(!1),d(!1)):(a(!e),d(!1))}),[n.camera,n.microphone,t]),(0,i.jsx)(g,{children:(0,i.jsx)(u.Flex,{hAlignContent:"center",vertical:!0,vAlignContent:"center",height:"100%",children:!l&&(0,i.jsx)(i.Fragment,{children:o?(0,i.jsx)(me,{}):(0,i.jsx)(Re,{})})})})}var Me=t(29815);function Le(){var e=(0,u.useToaster)(),n=(0,c.useState)(!1),t=n[0],r=n[1],o=V((function(e){return e})),a=o.localTracks,l=o.room,d=o.clearTrack,h=o.setLocalTracks,p=o.devicePermissions,f=o.setDevicePermissions,v=we(p).hasVideoInputDevices,m=function(){var n=(0,le.Z)((function(){var n,i,o,c,u;return(0,ue.__generator)(this,(function(p){switch(p.label){case 0:return t?[3,4]:a.video?(a.video.stop(),d("video"),o=null===l||void 0===l||null===(n=l.localParticipant)||void 0===n?void 0:n.unpublishTrack(a.video),null===l||void 0===l||null===(i=l.localParticipant)||void 0===i||i.emit("trackUnpublished",o),[3,4]):[3,1];case 1:return r(!0),(c=localStorage.getItem(H))?[3,3]:[4,navigator.mediaDevices.enumerateDevices().then((function(e){var n,t=null===(n=e.find((function(e){return"videoinput"===e.kind})))||void 0===n?void 0:n.deviceId;return null!==t&&void 0!==t?t:null}))];case 2:u=p.sent(),c=u,p.label=3;case 3:c?s.createLocalTracks({video:{deviceId:c},audio:!1}).then((function(e){var n;h("video",e[0]),f("camera",!0),r(!1),null===l||void 0===l||null===(n=l.localParticipant)||void 0===n||n.publishTrack(e[0])})).catch((function(n){e.push({message:"Error: ".concat(n.message),variant:"error"}),f("camera",!1)})):(e.push({message:"Error: No video device found",variant:"error"}),f("camera",!1)),p.label=4;case 4:return[2]}}))}));return function(){return n.apply(this,arguments)}}();return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(u.Tooltip,{text:v?a.video?"Stop Camera":"Start Camera":"No video",placement:"bottom",children:(0,i.jsx)(u.Button,{variant:a.video?"primary":"destructive",size:"circle",onClick:m,children:a.video?(0,i.jsx)(xe.LsT,{style:{width:"25px",height:"25px"}}):(0,i.jsx)(xe.kwV,{style:{width:"25px",height:"25px"}})})}),(0,i.jsx)(u.Toaster,(0,O.Z)({},e))]})}function Be(e){var n=(0,c.useState)(!!e&&e.isEnabled),t=n[0],i=n[1];return(0,c.useEffect)((function(){if(i(!!e&&e.isEnabled),e){var n=function(){return i(!0)},t=function(){return i(!1)};return e.on("enabled",n),e.on("disabled",t),function(){e.off("enabled",n),e.off("disabled",t)}}}),[e]),t}function Ve(){var e=(0,u.useToaster)(),n=V((function(e){return e})),t=n.localTracks,r=n.setLocalTracks,o=n.room,a=n.setDevicePermissions,c=t.audio,l=Be(c),d=function(){var n=(0,le.Z)((function(){var n,t;return(0,ue.__generator)(this,(function(i){switch(i.label){case 0:return c?(c.isEnabled?c.disable():c.enable(),[3,4]):[3,1];case 1:return(n=localStorage.getItem(W))?[3,3]:[4,navigator.mediaDevices.enumerateDevices().then((function(e){var n,t=null===(n=e.find((function(e){return"audioinput"===e.kind})))||void 0===n?void 0:n.deviceId;return null!==t&&void 0!==t?t:null}))];case 2:t=i.sent(),n=t,i.label=3;case 3:n?s.createLocalTracks({audio:{deviceId:n},video:!1}).then((function(e){var n;r("audio",e[0]),a("microphone",!0),null===o||void 0===o||null===(n=o.localParticipant)||void 0===n||n.publishTrack(e[0])})).catch((function(n){e.push({message:"Error: ".concat(n.message),variant:"error"}),a("microphone",!1)})):(e.push({message:"Error: No audio input device found",variant:"error"}),a("microphone",!1)),i.label=4;case 4:return[2]}}))}));return function(){return n.apply(this,arguments)}}();return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(u.Tooltip,{text:c?l?"Mute mic":"Unmute mic":"No audio",placement:"bottom",children:(0,i.jsx)(u.Button,{variant:l?"primary":"destructive",size:"circle",onClick:d,children:l?(0,i.jsx)(xe.OnQ,{style:{width:"25px",height:"25px"}}):(0,i.jsx)(xe.P2d,{style:{width:"25px",height:"25px"}})})}),(0,i.jsx)(u.Toaster,(0,O.Z)({},e))]})}var We=t(37106);function Ue(e){var n=(0,c.useState)(),t=n[0],i=n[1];return(0,c.useEffect)((function(){if(e){var n=function(){i(Array.from(e.participants.values()).concat(e.localParticipant).find((function(e){return Array.from(e.tracks.values()).find((function(e){return e.trackName.includes("screen")}))})))};return n(),e.on("trackPublished",n),e.on("trackUnpublished",n),e.on("participantDisconnected",n),e.localParticipant.on("trackPublished",n),e.localParticipant.on("trackUnpublished",n),function(){e.off("trackPublished",n),e.off("trackUnpublished",n),e.off("participantDisconnected",n),e.localParticipant.off("trackPublished",n),e.localParticipant.off("trackUnpublished",n)}}}),[e]),t}function He(){var e=(0,u.useToaster)(),n=V((function(e){return e})).room,t=Ue(n),r=!!t&&t===(null===n||void 0===n?void 0:n.localParticipant),o=(0,be.Z)(function(e,n){var t=(0,c.useState)(!1),i=t[0],r=t[1],o=(0,c.useRef)(null),a=(0,c.useCallback)((function(){navigator.mediaDevices.getDisplayMedia({audio:!1,video:!0}).then((function(t){var i=t.getTracks()[0];e.localParticipant.publishTrack(i,{name:"screen",priority:"low"}).then((function(n){o.current=function(){e.localParticipant.unpublishTrack(i),e.localParticipant.emit("trackUnpublished",n),i.stop(),r(!1)},i.onended=o.current,r(!0)})).catch(n)})).catch((function(e){("Permission denied by system"===e.message||"AbortError"!==e.name&&"NotAllowedError"!==e.name)&&(console.error(e),n(e))}))}),[e,n]),s=(0,c.useCallback)((function(){e&&(i?o.current():a())}),[i,a,e]);return[i,s]}(n,(function(){e.push({message:"Could not share screen - please try again.",variant:"error"})})),2),a=o[0],s=o[1];return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(u.Tooltip,{text:t&&!r?"Someone else is sharing":a?"Stop sharing":"Share screen",placement:"top",children:(0,i.jsx)(u.Button,{variant:a?"destructive":"primary",size:"circle",onClick:s,disabled:!!t&&!r,children:a?(0,i.jsx)(We.tIC,{style:{width:"25px",height:"25px"}}):(0,i.jsx)(We.BfX,{style:{width:"25px",height:"25px"}})})}),(0,i.jsx)(u.Toaster,(0,O.Z)({},e))]})}var Ke=t(80471);function Ge(){var e=V((function(e){return e})).room,n=ie,t=re;return(0,i.jsxs)(u.PopoverContainer,{baseId:"popover-right-example",placement:"top",children:[(0,i.jsx)(u.PopoverButton,{variant:"destructive",size:"circle",children:(0,i.jsx)(Ke.Fk5,{style:{width:"25px",height:"25px"}})}),(0,i.jsx)(u.Popover,{"aria-label":"Popover",children:(0,i.jsxs)(u.Box,{width:"size20",children:[(0,i.jsx)(u.Heading,{as:"h3",variant:"heading30",children:n}),(0,i.jsx)(u.Separator,{orientation:"horizontal",verticalSpacing:"space50"}),(0,i.jsx)(u.Text,{as:"span",children:t}),(0,i.jsx)(u.Separator,{orientation:"horizontal",verticalSpacing:"space50"}),(0,i.jsx)(u.Button,{onClick:function(){e&&e.disconnect()},variant:"destructive",fullWidth:!0,children:"Disconnect"})]})})]})}function qe(e){var n=e.roomName,t=e.numParticipants;return(0,i.jsx)(N,{children:(0,i.jsx)(u.MediaObject,{as:"div",verticalAlign:"center",children:(0,i.jsxs)(u.MediaBody,{as:"div",children:[(0,i.jsx)(u.Text,{as:"p",fontSize:"fontSize30",fontWeight:"fontWeightMedium",children:n}),(0,i.jsxs)(u.Text,{as:"p",fontSize:"fontSize20",children:[t," participant",t>1&&"s"]})]})})})}function Xe(e){var n=(0,c.useState)([]),t=n[0],i=n[1];return(0,c.useEffect)((function(){i(Array.from(e.tracks.values()));var n=function(e){i((function(n){return(0,Me.Z)(n).concat([e])}))},t=function(e){i((function(n){return n.filter((function(n){return n!==e}))}))};return e.on("trackPublished",n),e.on("trackUnpublished",t),function(){e.off("trackPublished",n),e.off("trackUnpublished",t)}}),[e]),t}function Qe(e){var n=(0,c.useState)(e&&e.track),t=n[0],i=n[1];return(0,c.useEffect)((function(){if(i(e&&e.track),e){var n=function(){return i(null)};return e.on("subscribed",i),e.on("unsubscribed",n),function(){e.off("subscribed",i),e.off("unsubscribed",n)}}}),[e]),t}function Ye(e){var n=e.track,t=e.priority,r=e.isLocal,o=(0,c.useRef)(null);(0,c.useEffect)((function(){var e=o.current;return e.muted=!0,n.setPriority&&t&&n.setPriority(t),n.attach(e),function(){n.detach(e),e.srcObject=null,n.setPriority&&t&&n.setPriority(null)}}),[n,t]);var a={transform:r?"scaleX(-1)":"",objectFit:"cover"};return(0,i.jsx)(f,{ref:o,style:a})}function Je(e){var n=e.track,t=(0,c.useRef)(),i=V((function(e){return e})).activeSinkId;return(0,c.useEffect)((function(){return t.current=n.attach(),t.current.setAttribute("data-cy-audio-track-name",n.name),document.body.appendChild(t.current),function(){return n.detach().forEach((function(e){e.remove(),e.srcObject=null}))}}),[n]),(0,c.useEffect)((function(){var e,n;null===(e=t.current)||void 0===e||null===(n=e.setSinkId)||void 0===n||n.call(e,null!==i&&void 0!==i?i:"")}),[i]),null}function $e(e){var n=e.publication,t=e.videoPriority,r=e.isLocal,o=Qe(n);if(!o)return null;switch(o.kind){case"video":return(0,i.jsx)(Ye,{track:o,priority:t,isLocal:r});case"audio":return(0,i.jsx)(Je,{track:o});default:return null}}function en(e){var n,t=e.participant,r=e.isMainFocus,o=e.isLocal,a=Xe(t);return n=r&&a.some((function(e){return e.trackName.includes("screen")}))?a.filter((function(e){return e.trackName.includes("screen")})):a.filter((function(e){return!e.trackName.includes("screen")})),(0,i.jsx)(i.Fragment,{children:n.map((function(e){return(0,i.jsx)($e,{publication:e,participant:t,isLocal:o},e.kind)}))})}var nn=[0,1,2,3,4],tn=h.iK.div((0,h.iv)({width:"1.5em",height:"1.5em",padding:"0.9em",display:"flex",alignItems:"center",justifyContent:"center"})),rn=h.iK.div((0,h.iv)({display:"flex",alignItems:"flex-end","& div":{width:"2px",marginRight:"1px","&:not(:last-child)":{borderRight:"none"}}}));function on(e){var n=function(e){var n=(0,c.useState)(e.networkQualityLevel),t=n[0],i=n[1];return(0,c.useEffect)((function(){var n=function(e){return i(e)};return i(e.networkQualityLevel),e.on("networkQualityLevelChanged",n),function(){e.off("networkQualityLevelChanged",n)}}),[e]),t}(e.participant);return null===n?null:(0,i.jsx)(tn,{children:(0,i.jsx)(rn,{children:nn.map((function(e){return(0,i.jsx)("div",{style:{height:"".concat(3*(e+1),"px"),background:n>e?"rgba(0, 0, 0, 0.5)":"rgba(255, 255, 255, 0.2)"}},e)}))})})}function an(e){var n=(0,c.useState)(""),t=n[0],i=n[1],r=function(e){console.log("Received data",e),function(e){i(e),setTimeout((function(){i("")}),1e4)}(e)},o=function(e){e.on("message",r)};return(0,c.useEffect)((function(){return function(){var n;null===e||void 0===e||e.off("subscribed",o),null===e||void 0===e||null===(n=e.track)||void 0===n||n.off("message",r)}}),[]),(0,c.useEffect)((function(){if(e)return e.track?e.track.on("message",r):e.on("subscribed",o),function(){e.off("subscribed",o)}}),[e]),t}function cn(e){var n=e.isLocalParticipant,t=e.emojiPublication,r=(n?V((function(e){return e})):{localEmoji:null}).localEmoji,o=n?null:an(t);return(0,i.jsx)(j,{children:n&&r?(0,i.jsx)(i.Fragment,{children:r}):(0,i.jsx)(i.Fragment,{children:o&&(0,i.jsx)(i.Fragment,{children:o})})})}function sn(e){var n=e.participant,t=e.isLocalParticipant,r=e.isDominantSpeaker,o=e.isMainFocus,a=e.children,s=n.identity,l=Xe(n),d=l.find((function(e){return"audio"===e.kind})),p=l.find((function(e){return!e.trackName.includes("screen")&&"video"===e.kind})),f=l.find((function(e){return"data"===e.kind&&"emoji"===e.trackName})),g=Boolean(p),j=l.find((function(e){return e.trackName.includes("screen")})),b=function(e){var n=(0,c.useState)(e&&e.isSwitchedOff),t=n[0],i=n[1];return(0,c.useEffect)((function(){if(i(e&&e.isSwitchedOff),e){var n=function(){return i(!0)},t=function(){return i(!1)};return e.on("switchedOff",n),e.on("switchedOn",t),function(){e.off("switchedOff",n),e.off("switchedOn",t)}}}),[e]),!!t}(Qe(p)),S=Be(Qe(d)),y=h.iK.div((0,h.iv)({border:"3px solid ".concat(r?"rgb(4, 184, 52)":"rgb(197, 199, 197)"),borderRadius:"10px",width:"100%",backgroundColor:"#000000"}));return(0,i.jsx)(y,{id:n.sid,children:(0,i.jsxs)(m,{children:[(0,i.jsx)(cn,{isLocalParticipant:t,emojiPublication:f}),(0,i.jsx)(k,{children:(0,i.jsxs)(u.Stack,{orientation:"horizontal",spacing:"space10",children:[!!j&&(0,i.jsx)(We.BfX,{style:{width:"14px",height:"14px",marginTop:"4px",marginRight:"3px"}}),(0,i.jsx)(on,{participant:n}),!S&&(0,i.jsx)(xe.P2d,{style:{width:"12px",height:"12px",color:"rgb(221, 39, 0)"}}),(0,i.jsx)(u.Text,{as:"p",color:"colorText",fontSize:["fontSize10","fontSize20","fontSize30"],children:t?"".concat(s," (you)"):s})]})}),(0,i.jsxs)(x,{children:[!o&&(!g||b)&&(0,i.jsx)(v,{children:(0,i.jsx)(u.Avatar,{size:["sizeIcon70","sizeIcon110"],name:s})}),a]})]})})}function ln(e){var n=e.participant,t=e.isLocalParticipant,r=e.isDominantSpeaker,o=e.isMainFocus;return(0,i.jsx)(sn,{participant:n,isLocalParticipant:t,isDominantSpeaker:r,isMainFocus:o,children:(0,i.jsx)(en,{isLocal:t,participant:n,isMainFocus:o})})}var un=function(e,n,t,i){var r=e,o=e*K,a=Math.floor(t/r);return Math.ceil(n/a)*o<=i};function dn(e){var n=(0,c.useRef)(null),t=(0,c.useState)(0),i=t[0],r=t[1],o=(0,c.useCallback)((function(){if(n.current){for(var t=n.current.offsetWidth-8,i=Math.max(n.current.offsetHeight-8,75),o=0,a=Math.pow(2,14);a-o>1;){var c=(a-o)/2+o;un(c,e,t,i)?o=c:a=c}var s=Math.ceil(o);r(s-8)}}),[e]);return(0,c.useEffect)((function(){var e=new window.ResizeObserver(o);return e.observe(n.current),function(){e.disconnect()}}),[o]),(0,c.useLayoutEffect)(o,[o]),{participantVideoWidth:i,containerRef:n}}function hn(e){var n=e.orderedParticipants,t=e.dominantSpeaker,r=V((function(e){return e})).room,o=dn(n.length>0?n.length+1:1),a=o.participantVideoWidth,c=o.containerRef,s="".concat(a,"px"),l="".concat(Math.floor(a*K),"px");return(0,i.jsxs)(S,{ref:c,children:[n.length>0&&n.map((function(e){var n=!!t&&t.sid===e.participant.sid;return(0,i.jsx)("div",{style:{width:s,height:l,margin:4},children:(0,i.jsx)(ln,{participant:e.participant,isLocalParticipant:!1,isDominantSpeaker:n,isMainFocus:!1})},e.participant.sid)})),(0,i.jsx)("div",{style:{width:s,height:l,margin:4},children:(0,i.jsx)(ln,{participant:r.localParticipant,isLocalParticipant:!0,isMainFocus:!1})},r.localParticipant.sid)]})}function pn(e){var n=e.orderedParticipants,t=e.dominantSpeaker,r=V((function(e){return e})).room,o=dn(n.length>0?n.length+1:1),a=o.participantVideoWidth,c=o.containerRef,s="".concat(a,"px"),l="".concat(Math.floor(a*K),"px");return(0,i.jsxs)(T,{ref:c,children:[n.length>0&&n.map((function(e){var n=!!t&&t.sid===e.participant.sid;return(0,i.jsx)("div",{style:{width:s,height:l,margin:4},children:(0,i.jsx)(ln,{participant:e.participant,isLocalParticipant:!1,isDominantSpeaker:n,isMainFocus:!1})},e.participant.sid)})),(0,i.jsx)("div",{style:{width:s,height:l,margin:4},children:(0,i.jsx)(ln,{participant:r.localParticipant,isLocalParticipant:!0,isMainFocus:!1})},r.localParticipant.sid)]})}function fn(e){var n=e.orderedParticipants,t=e.dominantSpeaker,r=e.screenShareParticipant;return(0,i.jsx)(w,{children:(0,i.jsxs)(u.Flex,{width:["100%"],height:"100%",vertical:[!0,!0,!1],children:[(0,i.jsx)(u.Box,{width:["100%","100%","80%"],height:["80%","80%","100%"],verticalAlign:"center",children:(0,i.jsx)(u.Flex,{width:"100%",height:"100%",vAlignContent:"center",children:(0,i.jsx)(ln,{participant:r,isLocalParticipant:!1,isMainFocus:!0})})}),(0,i.jsx)(u.Box,{width:["100%","100%","20%"],height:["20%","20%","100%"],children:(0,i.jsx)(pn,{orderedParticipants:n,dominantSpeaker:t})})]})})}var vn=t(63048);function mn(e){var n=e.menu,t=(0,c.useState)(!1),r=t[0],o=t[1],a=function(){return o(!1)},s=(0,Se.useUID)(),l=V((function(e){return e})),d=l.localTracks,h=l.setLocalEmoji,p=l.localEmoji;return(0,c.useEffect)((function(){if(p){var e=setTimeout((function(){h("")}),1e4);return function(){return clearTimeout(e)}}}),[p]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(u.MenuItem,(0,A.Z)((0,O.Z)({},n),{onClick:function(){o(!0)},children:(0,i.jsxs)(u.MediaObject,{verticalAlign:"center",children:[(0,i.jsx)(u.MediaBody,{children:"Emoji Reactions"}),(0,i.jsx)(u.MediaFigure,{spacing:"space20",children:(0,i.jsx)(ye.fmn,{style:{width:"12px",height:"12px"}})})]})})),(0,i.jsxs)(u.Modal,{ariaLabelledby:s,isOpen:r,onDismiss:a,size:"default",children:[(0,i.jsx)(u.ModalHeader,{children:(0,i.jsx)(u.ModalHeading,{as:"h3",id:s,children:"Choose an Emoji Reaction \ud83d\ude0e"})}),(0,i.jsx)(u.ModalBody,{children:(0,i.jsx)(vn.ZP,{width:"100%",onEmojiClick:function(e){return function(e){var n;null===d||void 0===d||null===(n=d.data)||void 0===n||n.send(e.emoji),h(e.emoji),a()}(e)}})})]})]})}function xn(e){var n=e.menu,t=e.closeMenu,r=(0,R.useRouter)(),o=(0,u.useToaster)(),a=V((function(e){return e})).formData;function c(){return(c=(0,le.Z)((function(){var e,n;return(0,ue.__generator)(this,(function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),e="".concat(window.location.origin).concat(r.basePath,"/index.html?roomName=").concat(a.roomName),"clipboard"in navigator?[4,navigator.clipboard.writeText(e)]:[3,2];case 1:i.sent(),i.label=2;case 2:return o.push({message:"Invite link copied to clipboard!",variant:"success",dismissAfter:3e3}),[3,4];case 3:return n=i.sent(),console.log("error",n),o.push({message:"Error copying invite link",variant:"error"}),[3,4];case 4:return t(),[2]}}))}))).apply(this,arguments)}return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(u.MenuItem,(0,A.Z)((0,O.Z)({},n),{onClick:function(){!function(){c.apply(this,arguments)}()},children:(0,i.jsxs)(u.MediaObject,{verticalAlign:"center",children:[(0,i.jsx)(u.MediaBody,{children:"Copy Invite Link"}),(0,i.jsx)(u.MediaFigure,{spacing:"space20",children:(0,i.jsx)(ye.XKb,{style:{width:"12px",height:"12px"}})})]})})),(0,i.jsx)(u.Toaster,(0,O.Z)({},o))]})}function gn(){var e=(0,u.useMenuState)();return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(u.MenuButton,(0,A.Z)((0,O.Z)({},e),{variant:"reset",size:"reset",children:(0,i.jsx)(ye.$Pu,{style:{width:"20px",height:"20px",marginTop:"5px"}})})),(0,i.jsxs)(u.Menu,(0,A.Z)((0,O.Z)({},e),{"aria-label":"Preferences",children:[(0,i.jsx)(mn,{menu:e,closeMenu:function(){return e.hide()}}),(0,i.jsx)(xn,{menu:e,closeMenu:function(){return e.hide()}})]}))]})}function jn(e){e=null!==e?e:(0,Z.Z)(new TypeError("Cannot destructure undefined"));var n,t,r=V((function(e){return e})),o=r.room,a=r.formData,s=r.setUIStep,l=r.localTracks,d=r.setDisconnectError,h=(0,c.useState)(null),p=h[0],f=h[1],v=(0,c.useState)(Array.from(null!==(t=null===o||void 0===o||null===(n=o.participants)||void 0===n?void 0:n.values())&&void 0!==t?t:[],(function(e){return{participant:e,dominantSpeakerStartTime:0}}))),m=v[0],x=v[1],g=Ue(o),j=te;return(0,c.useEffect)((function(){if(o){var e=Array.from(o.participants.values(),(function(e){return{participant:e,dominantSpeakerStartTime:0}}));x(e);var n=function(e){x((function(n){return(0,Me.Z)(n).concat([{participant:e,dominantSpeakerStartTime:0}])}))},t=function(e){x((function(n){return n.filter((function(n){return n.participant!==e}))}))},i=function(e){f(e||null)};return o.on("participantConnected",n),o.on("participantDisconnected",t),o.on("dominantSpeakerChanged",i),o.once("disconnected",(function(e){var n,t,i;null===(n=l.audio)||void 0===n||n.stop(),null===(t=l.video)||void 0===t||t.stop(),null===(i=l.screen)||void 0===i||i.stop(),e&&d(e.code,e.message),s(F.VIDEO_ROOM_DISCONNECT)})),function(){o.off("participantConnected",n),o.off("participantDisconnected",t),o.off("dominantSpeakerChanged",i)}}}),[o]),(0,c.useEffect)((function(){var e=setInterval((0,le.Z)((function(){return(0,ue.__generator)(this,(function(e){return null===o||void 0===o||o.getStats().then((function(e){return De(e[0])})).catch((function(e){return console.log("error gathering WebRTC stats",e)})),[2]}))})),15e3);return function(){return clearInterval(e)}}),[o]),window.addEventListener("beforeunload",(function(){null===o||void 0===o||o.disconnect()})),(0,i.jsxs)(C,{children:[!m.length&&(0,i.jsx)(E,{children:(0,i.jsx)(u.Text,{as:"p",fontSize:"fontSize60",fontWeight:"fontWeightMedium",color:"colorTextBrandInverse",textAlign:"center",padding:"space60",children:j})}),g&&g!==(null===o||void 0===o?void 0:o.localParticipant)?(0,i.jsx)(fn,{orderedParticipants:m,dominantSpeaker:p,screenShareParticipant:g}):(0,i.jsx)(hn,{orderedParticipants:m,dominantSpeaker:p}),(0,i.jsx)(I,{children:(0,i.jsxs)(u.Flex,{width:"100%",height:"100%",vAlignContent:"center",children:[(0,i.jsx)(u.Flex,{children:(0,i.jsx)(qe,{roomName:a.roomName,numParticipants:m.length+1})}),(0,i.jsx)(u.Flex,{grow:!0,hAlignContent:"center",children:(0,i.jsxs)(u.Stack,{orientation:"horizontal",spacing:"space70",children:[(0,i.jsx)(Ve,{}),(0,i.jsx)(Le,{}),(0,i.jsx)(He,{}),(0,i.jsx)(Te,{}),(0,i.jsx)(gn,{})]})}),(0,i.jsx)(u.Flex,{children:(0,i.jsx)(u.Flex,{width:"100%",hAlignContent:"right",vAlignContent:"center",children:(0,i.jsx)(Ge,{})})})]})})]})}var kn={53001:{id:53001,cause:"The client failed to reconnect to Twilio's signaling server after a network disruption or handoff",solution:"User should make sure to have a stable internet connection"},53002:{id:53002,cause:"The liveliness checks for the connection to Twilio's signaling server failed, or the current session expired",solution:"User should rejoin the Room"},53205:{id:53205,cause:"Another client joined the Room with the same identity",solution:"Your app should make sure each client creates an AccessToken with a unique identity string"},53405:{id:53405,cause:"The client failed to re-establish its media connection with the Room after a network disruption or handoff",solution:"1. User should make sure to have a stable internet connection 2. If the user is behind a firewall, then it should allow media traffic to and from Twilio to go through"},53118:{id:53118,solution:"",cause:"The room was ended by the system"}},bn=t(89583);function Sn(e){e=null!==e?e:(0,Z.Z)(new TypeError("Cannot destructure undefined"));var n=ce,t=se,r=V((function(e){return e})),o=r.room,a=r.formData,s=r.clearActiveRoom,l=(0,c.useState)(null),d=l[0],h=l[1],p=(0,c.useState)([]),f=p[0],v=p[1],m=(0,c.useState)(""),x=m[0],g=m[1],j=(0,c.useState)(!1),k=j[0],b=j[1],S=function(){return(0,i.jsx)(u.Flex,{width:"100%",hAlignContent:"center",marginTop:"space60",children:(0,i.jsx)(u.Text,{as:"p",fontSize:"fontSize30",fontWeight:"fontWeightMedium",color:"colorTextIconSuccess",children:"Thanks for your response!"})})};function y(){return w.apply(this,arguments)}function w(){return(w=(0,le.Z)((function(){var e;return(0,ue.__generator)(this,(function(n){switch(n.label){case 0:return console.log("----- submitting survey response -----"),e={roomSid:null===o||void 0===o?void 0:o.sid,roomName:a.roomName,participantSid:null===o||void 0===o?void 0:o.localParticipant.sid,participantIdentity:a.identity,thumbsUpOrDown:null!==d&&void 0!==d?d:"up",issuesFaced:f,otherIssues:x},console.log("payload to submit to data warehouse: ",e),[4,Fe(e)];case 1:return n.sent(),b(!0),s(),[2]}}))}))).apply(this,arguments)}return(0,i.jsxs)(u.Flex,{vertical:!0,vAlignContent:"center",width:"100%",children:[(0,i.jsx)(u.Heading,{as:"h4",variant:"heading40",children:n}),(0,i.jsx)(u.Text,{as:"p",fontSize:"fontSize20",fontWeight:"fontWeightMedium",color:"colorText",children:t}),(0,i.jsxs)(u.Flex,{vertical:!0,width:"100%",hAlignContent:"center",marginTop:"space60",marginBottom:"space30",children:[(0,i.jsx)(u.Text,{as:"p",fontSize:"fontSize30",fontWeight:"fontWeightBold",color:"colorTextIconOffline",marginBottom:"space30",children:"How was the video & audio quality?"}),(0,i.jsxs)(u.ButtonGroup,{attached:!0,children:[(0,i.jsx)(u.Button,{variant:"up"===d?"primary":"secondary",disabled:!!d,onClick:(0,le.Z)((function(){return(0,ue.__generator)(this,(function(e){switch(e.label){case 0:return h("up"),[4,y()];case 1:return e.sent(),[2]}}))})),children:(0,i.jsx)(u.Flex,{width:"100%",minWidth:"100px",hAlignContent:"center",children:(0,i.jsx)(bn.nM7,{style:{width:"25px",height:"25px"}})})}),(0,i.jsx)(u.Button,{variant:"down"===d?"destructive":"secondary",disabled:!!d,onClick:function(){return h("down")},children:(0,i.jsx)(u.Flex,{width:"100%",minWidth:"100px",hAlignContent:"center",children:(0,i.jsx)(bn.VK,{style:{width:"25px",height:"25px"}})})})]}),"down"===d&&(0,i.jsxs)(u.Flex,{width:"100%",hAlignContent:"center",marginTop:"space60",vertical:!0,children:[(0,i.jsx)(u.Text,{as:"p",fontSize:"fontSize30",fontWeight:"fontWeightBold",color:"colorTextIconOffline",marginBottom:"space30",children:"What went wrong?"}),(0,i.jsx)(u.Flex,{width:"100%",wrap:!0,hAlignContent:"center",marginBottom:"space30",children:G.map((function(e,n){return(0,i.jsx)(u.Flex,{marginRight:"space30",marginBottom:"space30",children:(0,i.jsx)(u.Button,{variant:-1!==f.indexOf(e)?"destructive":"secondary",disabled:k,onClick:function(){-1!==f.indexOf(e)?v((function(n){return n.filter((function(n){return n!==e}))})):v((function(n){return(0,Me.Z)(n).concat([e])}))},children:e})},n)}))}),-1!==f.indexOf("Other issue")&&(0,i.jsxs)(u.Flex,{vertical:!0,minWidth:"250px",marginTop:"space30",marginBottom:"space30",children:[(0,i.jsx)(u.Label,{htmlFor:"other",children:"Summary"}),(0,i.jsx)(u.TextArea,{onChange:function(e){return g(e.target.value)},placeholder:"Please describe the other issues faced",disabled:k})]}),(0,i.jsx)(u.Button,{type:"submit",variant:"primary",style:{background:"#F22F46"},onClick:(0,le.Z)((function(){return(0,ue.__generator)(this,(function(e){switch(e.label){case 0:return[4,y()];case 1:return[2,e.sent()]}}))})),disabled:k,children:k?"Thanks for your feedback!":"Submit feedback"})]}),k&&(0,i.jsx)(S,{})]})]})}var yn=t(83454);function wn(e){e=null!==e?e:(0,Z.Z)(new TypeError("Cannot destructure undefined"));var n=ae,t=oe,r=V((function(e){return e})),o=r.resetState,a=r.disconnectError,c=null===a||void 0===a?void 0:a.code,s=c?kn[c]:null;return(0,i.jsx)(g,{children:(0,i.jsxs)(u.Flex,{hAlignContent:"center",vertical:!0,vAlignContent:"center",height:"100%",children:[c&&(0,i.jsx)(P,{children:(0,i.jsxs)(u.Card,{children:[(0,i.jsxs)(u.Heading,{as:"h4",variant:"heading40",children:["Disconnection Error - ",c]}),(0,i.jsxs)(u.Callout,{variant:"error",marginY:"space40",children:[(0,i.jsx)(u.CalloutHeading,{as:"h3",children:n}),(0,i.jsx)(u.CalloutText,{children:null===s||void 0===s?void 0:s.cause})]}),(0,i.jsxs)(u.Text,{as:"p",fontSize:"fontSize20",fontWeight:"fontWeightMedium",color:"colorText",children:[null===s||void 0===s?void 0:s.solution,"."]})]})}),(0,i.jsx)(P,{children:(0,i.jsxs)(u.Card,{children:[yn.env.NEXT_PUBLIC_SURVEY_ENDPOINT?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(Sn,{}),(0,i.jsx)(u.Separator,{orientation:"horizontal",verticalSpacing:"space50"})]}):(0,i.jsx)(u.Heading,{as:"h4",variant:"heading40",children:t}),(0,i.jsx)(u.Flex,{marginTop:"space60",hAlignContent:"center",children:(0,i.jsx)(u.Button,{type:"submit",variant:"destructive",onClick:function(){return o()},children:"Rejoin video room"})})]})})]})})}function Tn(){var e=V((function(e){return e.uiStep}));return(0,i.jsx)(_,{children:function(){switch(e){case F.LANDING_SCREEN:return(0,i.jsx)(ve,{});case F.PRE_JOIN_SCREEN:return(0,i.jsx)(ze,{});case F.VIDEO_ROOM:return(0,i.jsx)(jn,{});case F.VIDEO_ROOM_DISCONNECT:return(0,i.jsx)(wn,{});default:return(0,i.jsx)(ve,{})}}()})}var Cn=function(){return(0,i.jsxs)(a.Box,{as:"main",children:[(0,i.jsx)(o(),{children:(0,i.jsx)("title",{children:"Twilio Video"})}),(0,i.jsx)(Tn,{})]})}}},function(e){e.O(0,[907,228,260,445,955,13,617,307,964,422,32,49,774,888,179],(function(){return n=48312,e(e.s=n);var n}));var n=e.O();_N_E=n}]);